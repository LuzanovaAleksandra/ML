---
title: "ggplot2"
output:
  word_document: default
  html_notebook: default
  pdf_document: default
  html_document: default
---

# Download the data
```{r}
#Source files are here
#setwd('D:/ML')
#Download the files
f1 <- read.csv2('flats_test.csv', header = TRUE, encoding = 'UNICOD')
f2 <- read.csv2('flats_fit.csv', header = TRUE, encoding = 'UNICOD')
f2 <- f2[-1]
f <- dplyr::bind_cols(f1, f2)
f <- f[,-1]
f$type <- as.factor(f$type)
head(f)
```

# Basic tasks

## Basic plot setup
```{r}
library(ggplot2)
gg <- ggplot(f, aes(x=m2, y=price)) 
gg + geom_point()
```

## Static - point size, shape, color and boundary thickness
```{r}
gg + geom_point(size=1, shape=1, color="steelblue", stroke=2)  # 'stroke' controls the thickness of point boundary
```

## Dynamic - point size, shape, color and boundary thickness
```{r}
#Make the aesthetics vary based on a variable.
gg + geom_point(aes(size=rooms, shape=location, color=type, stroke=condition))  
```

## Add Title, X and Y axis labels
```{r}
gg1 <- gg + geom_point(aes(color=type))
gg2 <- gg1 + labs(title="Flats", x="M2", y="Price")  
print(gg2)
```

## Change color of all text
```{r}
gg2 + theme(text=element_text(color="dark blue"))  # all text turns blue.
```

## Change title, X and Y axis label and text size
```{r}
gg3 <- gg2 + theme(plot.title=element_text(size=15), axis.title.x=element_text(size=10), axis.title.y=element_text(size=10), axis.text.x=element_text(size=5), axis.text.y=element_text(size=5))
print(gg3)
```

## Adjust X and Y axis limits
```{r}
gg3 + coord_cartesian(xlim=c(0,100), ylim=c(0, 100000)) + geom_smooth()  # zoom in
```

## Rotate axis text
```{r}
gg3 + theme(axis.text.x=element_text(angle=90), axis.text.y=element_text(angle=45))
```

## Flip X and Y Axis
```{r}
gg3 + coord_flip()  # flips X and Y axis.
```

## Grid lines and panel background
```{r}
gg3 + theme(panel.background = element_rect(fill = 'gray'),
  panel.grid.major = element_line(colour = "firebrick", size=2),
  panel.grid.minor = element_line(colour = "dark blue", size=1))
```

## Plot margin and background
```{r}
gg3 + theme(plot.background=element_rect(fill="yellowgreen"), plot.margin = unit(c(2, 4, 1, 3), "cm")) # top, right, bottom, left

#Colors

#The whole list of colors are displayed at your R console in the color() function. Here are few of my suggestions for nice looking colors and backgrounds:

#    steelblue (points and lines)
#    firebrick (point and lines)
#    springgreen (fills)
#    violetred (fills)
#    tomato (fills)
#    skyblue (bg)
#    sienna (points, lines)
#    slateblue (fills)
#    seagreen (points, lines, fills)
#    sandybrown (fills)
#    salmon (fills)
#    saddlebrown (lines)
#    royalblue (fills)
#    orangered (point, lines, fills)
#    olivedrab (points, lines, fills)
#    midnightblue (lines)
#    mediumvioletred (points, lines, fills)
#    maroon (points, lines, fills)
#    limegreen (fills)
#    lawngreen (fills)
#    forestgreen (lines, fills)
#    dodgerblue (fills, bg)
#    dimgray (grids, secondary bg)
#    deeppink (fills)
#    darkred (lines, points)
```

# Legend

## Hide legend
```{r}
gg3 + theme(legend.position="none")  # hides the legend
```

## Change legend position
```{r}
#Outside plot
p1 <- gg3 + theme(legend.position="top")  # top / bottom / left / right
#Inside plot
p2 <- gg3 + theme(legend.justification=c(1,0), legend.position=c(1,0))  # legend justification is the anchor point on the legend, considering the bottom left of legend as (0,0)
gridExtra::grid.arrange(p1, p2, ncol=2)
```

# Plot text and annotation

## Add text in chart
```{r}
gg + geom_text(aes(label=type, color=location), size=3) 
```

## Annotation
```{r}
library(grid)
my_grob = grobTree(textGrob("Linear?", x=0.8, y=0.2, gp=gpar(col="firebrick", fontsize=25, fontface="bold")))
gg3 + annotation_custom(my_grob)
```

# Geom layers

## Add smoothing line
```{r}
gg3 + geom_smooth(aes())  # method could be - 'lm', 'loess', 'gam'
```

## Add horizontal/vertical line
```{r}
p1 <- gg3 + geom_hline(yintercept=100000, size=2, linetype="dotted", color="green") # linetypes: solid, dashed, dotted, dotdash, longdash and twodash
p2 <- gg3 + geom_vline(xintercept=100, size=2, color="firebrick")
gridExtra::grid.arrange(p1,p2, ncol=2)
```

# Add bar chart

## Frequency bar chart: Specify only X axis.
```{r}
gg <- ggplot(f, aes(x=location))
gg + geom_bar()  # frequency table
```

## Distinct color for bars
```{r}
gg_bar <- ggplot(f, aes(x=location, y=price)) + geom_bar(stat = "identity", aes(fill=location))
print(gg_bar)
```

## Change color palette
```{r}
library(RColorBrewer)
display.brewer.all(n=20, exact.n=FALSE)  # display available color palettes
ggplot(f, aes(x=location, y=price, fill=factor(location))) + geom_bar(stat="identity") + scale_fill_brewer(palette="Reds")  # "Reds" is palette name
```

# Area
```{r}
ggplot(f, aes(x=m2)) + geom_area(aes(y=p_dt), fill="yellowgreen", color="yellowgreen") + geom_area(aes(y=p_sr), fill="dodgerblue", alpha=0.7, linetype="dotted") + labs(title="SR vs DT")
```

# Boxplot and Violin
```{r}
p1 <- ggplot(f, aes(factor(location), price)) + geom_boxplot(aes(fill = factor(location)), width=0.5, outlier.colour = "dodgerblue", outlier.size = 2, outlier.shape = 6, outlier.stroke = 2, notch=T) + labs(title="Box plot")
p2 <- ggplot(f, aes(factor(type), price)) + geom_violin(aes(fill = factor(type)), width=0.5, trim=F) + labs(title="Violin plot")
gridExtra::grid.arrange(p1, p2, ncol=2)
```

# Density
```{R}
ggplot(f, aes(price)) + geom_density(aes(fill = factor(location)), color="white", alpha=0.8, size=0.5) + labs(title="Density plot")  
```

# Tiles
```{r}
library(RColorBrewer)
ggplot(f, aes(x=location, y=condition, fill=price, label=price)) + geom_tile() + theme_bw() + labs(title="Correlation plot") + theme(text=element_text(size=20), legend.position="none")+ scale_fill_gradient2()
```
